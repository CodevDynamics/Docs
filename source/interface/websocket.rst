WebSocket 客户端
=====================================
    运行在机载设备上的 WebSocket 客户端程序：可用于推送飞机的遥测数据以及异步接受来自服务器的控制命令。

.. _msg-type-label:

消息类型
-----------------------
    作为客户端连接到 WebScoket 服务器，只发送和接受 Json 格式的数据。关键字：**msg_type**，用于代表消息类型，目前所以消息类型如下（持续更新）：

    ===========  ============ ============= ======== ===============================
    消息类型      发送方        接收方      是否应答     描述
    ===========  ============ ============= ======== ===============================
    1             飞行器         服务器        否       :ref:`telemetry-label`
    2             飞行器         服务器        否       :ref:`mission-progress-label`
    1000          服务器         飞行器        是       :ref:`arm-label`
    1001          服务器         飞行器        是       :ref:`takeoff-label`
    1002          服务器         飞行器        是       :ref:`land-label`
    1003          服务器         飞行器        是       :ref:`rtl-label`
    1004          服务器         飞行器        是       :ref:`hold-label`
    1005          服务器         飞行器        是       :ref:`posctl-label`
    1006          服务器         飞行器        是       :ref:`goto-location-label`
    1007          服务器         飞行器        是       :ref:`takephoto-label`
    1008          服务器         飞行器        是       :ref:`start-video-label`
    1009          服务器         飞行器        是       :ref:`stop-video-label`
    1010          服务器         飞行器        是       :ref:`start-mission-label`
    1011          服务器         飞行器        是       :ref:`cancel-mission-label`
    1012          服务器         飞行器        是       :ref:`continue-mission-label`
    1013          服务器         飞行器        是       :ref:`push-rtmp-video-stream-label`
    1496          服务器         飞行器        是       :ref:`get-mission-file-content-label`
    1497          服务器         飞行器        是       :ref:`delete-mission-file-label`
    1498          服务器         飞行器        是       :ref:`upload-mission-file-label`
    1499          服务器         飞行器        是       :ref:`request-mission-list-label`
    1500          服务器         飞行器        否       :ref:`manual-control-label`
    1501          服务器         飞行器        否       :ref:`gimbal-manual-control-label`
    ===========  ============ ============= ======== ===============================

.. _result-label:

飞行器返回执行结果
-----------------------
    对于需要应答的指令，Json 数据中包含 **result**，类型为 **Int**，含义如下表：

    ===========  =======================================
    返回值             描述
    ===========  =======================================
    -1             API 模块处理接受到的执行命令时，遇到异常：Json 参数错误、API 函数返回异常值
    0              未知错误，获取航线列表、上传任务文件、执行任务时失败会出现
    1              指令执行成功或者成功开始执行
    2              执行设备不存在
    3              执行设备连接错误
    4              执行设备忙碌
    5              执行设备拒绝执行
    6              飞行器状态未知拒绝执行
    7              飞行器未着陆拒绝执行
    8              指令超时
    9              VTOL 切换失败（旋翼机不会出现）
    10             飞行器不支持切换（旋翼机不会出现）
    11             指令参数不合法
    12             指令不支持
    13             指令执行失败
    ===========  =======================================

.. _mission-object-label:

任务对象格式说明
-----------------------
    ================= =========  ======== ===============================
    参数                类型       缺省      描述
    ================= =========  ======== ===============================
    latitude          Double      否       航点纬度
    longitude         Double      否       航点经度
    altitude          Double      否       航点相对高度（相对 Home 点）
    vehicle_action    Int         能       0: 普通航点，1: 起飞，2: 降落
    speed             Double      能       执行到该航点时，切换飞行器速度
    camera_action     Int         能       0: 无动作，1: 拍照，4: 开始录像，5: 停止录像
    gimbal_pitch      Double      能       云台 Pitch
    gimbal_yaw        Double      能       云台 Yaw
    is_fly_through    Bool        能       `false`: 在该航点位置进行短暂的悬停，`true`: 快速通过
    ================= =========  ======== ===============================

.. _telemetry-label:

飞行器遥测数据
-----------------------

飞行器发送
^^^^^^^^^^^^^^^
    ================= =========  ======== ===============================
    参数                类型       缺省      描述
    ================= =========  ======== ===============================
    msg_type           Int         否       :ref:`msg-type-label`
    aircraft_id        String      否       飞行器 UUID
    timestamp          Long        否       UTC 时间
    landed_state       String      否       "On Gound","In Air","Taking Off","Landing"
    flight_mode        String      否       "Ready"(可以起飞),"Takeoff","Hold","Mission","Return To Launch","Land","Posctl"
    home               Double[]    否       Home 点，4个浮点型，依次是纬度、经度、海拔高度、相对高度
    position           Double[]    否       飞行器当前位置，4个浮点型，依次是纬度、经度、海拔高度、相对高度
    aircraft_roll      Double      否       飞机 Roll，单位度
    aircraft_pitch     Double      否       飞机 Pitch，单位度
    aircraft_yaw       Double      否       飞机 Yaw，单位度
    satellite_number   Int         否       GPS 卫星数
    gps_fix_type       String      否       定位精度，"No GPS","No Fix","Fix 2D","Fix 3D"(从这个开始，已经完成定位),"Fix Dgps","Rtk Float","Rtk Fixed"
    aircraft_speed     Double      否       飞机飞行速度
    battery_percent    Double      否       飞机电池电量（0.0～1.0）
    gimbal_roll        Double      能       云台 Roll，单位度
    gimbal_pitch       Double      能       云台 Pitch，单位度
    gimbal_yaw         Double      能       云台 Yaw，单位度
    has_stream         Bool        能       是否有视频流
    ================= =========  ======== ===============================

例子
""""""""""""
    ::

        {
            "aircraft_id": "0600003633353833305117022024",
            "timestamp": 179525156,
            "landed_state": "On Ground",
            "flight_mode": "Posctl",
            "home": [
                23.173951,
                113.4198426,
                31.09400177,
                0
            ],
            "position": [
                23.1739512,
                113.4198423,
                30.76000214,
                -0.3340000212
            ],
            "aircraft_roll": -0.962998867,
            "aircraft_pitch": 0.8330261111,
            "aircraft_yaw": 9.299003601,
            "satellite_number": 10,
            "gps_fix_type": "Fix 3D",
            "aircraft_speed": 0.05999999866,
            "battery_percent": 100,
            "msg_type": 1
        }

.. _mission-progress-label:

飞行器任务执行进度
-----------------------

飞行器发送
^^^^^^^^^^^^^^^
    ================= =========  ======== ===============================
    参数                类型       缺省      描述
    ================= =========  ======== ===============================
    msg_type           Int         否       :ref:`msg-type-label`
    step               Int         否      0: 检查任务；1: 上传任务；2: 执行任务
    total              Int         否      当前步骤总进度
    sequence           Int         否      当前步骤进度
    ================= =========  ======== ===============================

例子
""""""""""""
    ::

        {
            "step": 0,
            "total": 100,
            "sequence": 10,
            "msg_type": 2
        }

.. _arm-label:

飞行器解锁（不解锁飞机将不会有任何动作）
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1000
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    armed         Bool      `true`: 解锁，`false`: 上锁
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "armed": true,
            "msg_type": 1000
        }

.. _takeoff-label:

飞行器切换起飞模式
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1001
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1001
        }

.. _land-label:

飞行器切换降落模式
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1002
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1002
        }

.. _rtl-label:

飞行器切换返航模式
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1003
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1003
        }

.. _hold-label:

飞行器切换悬停模式
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1004
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1004
        }

.. _posctl-label:

飞行器切换位置模式
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1005
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1005
        }

.. _goto-location-label:

飞行器到达指定点悬停
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1006
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    latitude      Double    目标纬度
    longitude     Double    目标经度
    altitude      Double    目标高度（相对高度）
    yaw           Double    飞机机头朝向
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "latitude": 31.12,
            "longitude": 120.12,
            "altitude": 50,
            "yaw": 66.8,
            "msg_type": 1006
        }

.. _takephoto-label:

相机拍照
----------------------------------------------

相机应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1007
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1007
        }

.. _start-video-label:

相机开始录像
----------------------------------------------

相机应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1008
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1008
        }

.. _stop-video-label:

相机停止录像
----------------------------------------------

相机应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1009
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1009
        }

.. _start-mission-label:

飞行器开始执行任务
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1010
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    name          String    需要执行的任务文件名称
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "name": "test.mission",
            "msg_type": 1010
        }

.. _cancel-mission-label:

飞行器取消当前任务（触发返航）
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1011
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1011
        }

.. _continue-mission-label:

飞行器继续当前任务（开始任务之后该命令有效）
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1012
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1012
        }

.. _push-rtmp-video-stream-label:

设置推送的码流到指定地址
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "msg_type": 1013
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    url           String    RTMP 推送地址
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1013,
            "url": "rtmp://127.0.0.1:1234"
        }

.. _get-mission-file-content-label:

获得指定任务文件的内容
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ============= ========== ===============================
    参数           类型       描述
    ============= ========== ===============================
    msg_type       Int       :ref:`msg-type-label`
    result         Int       :ref:`result-label`
    filename       String    任务文件名
    missionItems   Object[]  :ref:`mission-object-label`
    ============= ========== ===============================

    **只支持格式为mission任务文件内容查看**

例子
""""""""""""
    ::

        {
            "result": 1,
            "filename": "test.mission"
            "missionItems": [
                {
                    "latitude": 32.111,
                    "longitude": 120.111,
                    "altitude": 82.6,
                    "vehicle_action": 1
                },
                {
                    "latitude": 32.111,
                    "longitude": 120.112,
                    "altitude": 82.6,
                    "vehicle_action": 0,
                    "speed": 5.0,
                    "is_fly_through": true
                },
                {
                    "latitude": 32.111,
                    "longitude": 120.113,
                    "altitude": 82.6,
                    "camera_action": 0,
                    "gimbal_pitch": 10.0,
                    "gimbal_yaw": 45.0,
                    "is_fly_through": false
                }
            ],
            "msg_type": 1496
        }

服务端发送
^^^^^^^^^^^^^^^

    =============  ======== ===============================
    参数            类型       描述
    =============  ======== ===============================
    msg_type       Int       :ref:`msg-type-label`
    name           String    任务文件的名字
    =============  ======== ===============================

例子
""""""""""""
    ::

        {
            "name": "test.mission",
            "msg_type": 1496
        }

.. _delete-mission-file-label:

删除飞行器上的任务
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    filename      String    已经删除的任务文件的名称
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "filename": "test.mission"
            "msg_type": 1497
        }

服务端发送
^^^^^^^^^^^^^^^

    =============  ======== ===============================
    参数            类型       描述
    =============  ======== ===============================
    msg_type       Int       :ref:`msg-type-label`
    name           String    任务文件的名字
    =============  ======== ===============================

例子
""""""""""""
    ::

        {
            "name": "test.mission",
            "msg_type": 1497
        }

.. _upload-mission-file-label:

上传任务到飞行器
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    filename      String    返回实际创建任务文件的名称
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "filename": "test_1.mission"
            "msg_type": 1498
        }

服务端发送
^^^^^^^^^^^^^^^

    =============  ======== ===============================
    参数            类型       描述
    =============  ======== ===============================
    msg_type       Int       :ref:`msg-type-label`
    name           String    期望任务文件的名字
    missionItems   Object[]  :ref:`mission-object-label`
    =============  ======== ===============================

例子
""""""""""""
    ::

        {
            "name": "test.mission",
            "missionItems": [
                {
                    "latitude": 32.111,
                    "longitude": 120.111,
                    "altitude": 82.6,
                    "vehicle_action": 1
                },
                {
                    "latitude": 32.111,
                    "longitude": 120.112,
                    "altitude": 82.6,
                    "vehicle_action": 0,
                    "speed": 5.0,
                    "is_fly_through": true
                },
                {
                    "latitude": 32.111,
                    "longitude": 120.113,
                    "altitude": 82.6,
                    "camera_action": 0,
                    "gimbal_pitch": 10.0,
                    "gimbal_yaw": 45.0,
                    "is_fly_through": false
                }
            ],
            "msg_type": 1498
        }

.. _request-mission-list-label:

请求飞行器上的航点列表
----------------------------------------------

飞行器应答
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    result        Int       :ref:`result-label`
    plans        String[]   航点文件列表
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "result": 1,
            "plans": ["test.mission","12.plan"]
            "msg_type": 1499
        }

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "msg_type": 1499
        }

.. _manual-control-label:

飞行器手动控制包
----------------------------------------------

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    x             Double    飞行器前后控制（-1.0~1.0）
    y             Double    飞行器左右控制（-1.0~1.0）
    z             Double    飞行器上下控制（-1.0~1.0）
    r             Double    飞行器旋转（-1.0~1.0）
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0,
            "r": 0.5,
            "msg_type": 1500
        }

.. _gimbal-manual-control-label:

云台角度控制
----------------------------------------------

服务端发送
^^^^^^^^^^^^^^^

    ===========  ======== ===============================
    参数          类型       描述
    ===========  ======== ===============================
    msg_type      Int       :ref:`msg-type-label`
    pitch         Double    云台 Pitch，单位度
    yaw           Double    云台 Yaw，单位度
    ===========  ======== ===============================

例子
""""""""""""
    ::

        {
            "pitch": 0.0,
            "yaw": 45.0,
            "msg_type": 1501
        }